--------------------------------------------------------------------------------
--  Auteur   : MOUDDENE Hamza
--  Objectif : réviser les tables de multiplication
--------------------------------------------------------------------------------

with Ada.Text_IO;           use Ada.Text_IO;
with Ada.Integer_Text_IO;   use Ada.Integer_Text_IO;
with Ada.Calendar;          use Ada.Calendar;
With Alea;

procedure Multiplications is
    package Mon_Alea is
	new Alea (1, 10);  -- générateur de nombre dans l'intervalle [5, 15]
    use Mon_Alea;
    n_table: Integer;
    n_table_a_reviser: Integer := 0;
    nombre_alea: Integer;
    reponse: Integer;
    erreurs: Integer := 0;
    stop: Integer;
    Debut: Time;         -- heure de début de l'opération
    Fin: Time;           -- heure de fin de l'opération
    Delai : Duration;    -- durée de l'opération
    Max_Delai: Duration := Duration(0);
    Moyen_Delai: Duration := Duration(0);
begin
    put_Line("------------Bienvenue dans votre espace de travail-------------");
    New_Line;
    Repeter :
    loop
	Repeter_1 :
	loop
	    put("Table à réviser : ");
	    get(n_table);
	    New_Line;
	    exit Repeter_1 when n_table >= 1 and n_table <= 10;
	end loop Repeter_1;

	for i in 1..10 loop
	    Get_Random_Number(nombre_alea);
	    -- récupérer l'heure (heure de début)
	    Debut := Clock;	

	    Put("(M" &Integer'Image(i) & ")" & Integer'Image(n_table) & " * " & Integer'Image(nombre_alea) & " ? ");
	    Get(reponse);
	    -- récupérer l'heure (heure de fin)
	    Fin := Clock;
	    -- calculer la durée de l'opération
	    Delai := Fin - Debut;
	    if Delai > Max_Delai then
		n_table_a_reviser := nombre_alea;
		Moyen_Delai := Moyen_Delai + Delai;
		Max_Delai := Delai;
	    else
		Moyen_Delai := Moyen_Delai + Delai;
	    end if;

	    if reponse = n_table * nombre_alea then
		Put_Line("Bravo !");
	    else
		erreurs := erreurs + 1;
		Put_Line("Mauvaise réponse.");
	    end if;

	    New_Line;
	end loop;
	New_Line;
	Moyen_Delai := (Moyen_Delai / 10) + Duration(1);
	Put_Line("Des hésitations sur la table de " & Integer'Image(n_table_a_reviser) & " : " & Duration'Image(Max_Delai) & " secondes contre " & Duration'Image(Moyen_Delai) & " secondes en moyenne. Il faut certainement la réviser.");
	New_Line;
	case erreurs is
	    when 0      => Put_Line("Aucune erreur.Excellent!");
	    when 1      => Put_Line("Une seule  erreur. Très bien.");
	    when 10     => Put_Line("Tout est faux! Volontaire?");
	    when others => 
		if  erreurs > 5 then
		    Put_Line("Il faut apprendre la table de n!");
		else
		    Put_Line("Il faut encore travailler la table de n.");
		end if;
	end case;
	New_Line;
	Repeter_2 :
	loop
	    Put_Line("Vous voulez continuer de réviser ?");
	    Put_Line("Si oui tapez 1, sinon tapez 0");
	    Put("Votre choix : ");
	    get(stop);             
	    New_Line;
	    exit Repeter_2 when stop = 1 or stop = 0;
	end loop Repeter_2;
	exit repeter when stop = 0;
    end loop repeter;
    put_Line("--------------------------Au revoir----------------------------");

end Multiplications;
